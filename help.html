<h2>Using the image browser</h2>
<p>
    For best results, use a standards-compliant web browser
    such as Firefox (or Camino), Safari or Opera.
</p>
<p>
    Click and drag to move the image, zoom the image using
    the plus and minus keys on your number pad and select an
    image to view using the yellow slider in the top-left
    image. In most browsers you should also be able to use the
    mouse wheel over the image to zoom.
</p>
<p>
    When viewing Woolz objects, you can alter the pitch and
    yaw by clicking and dragging on the 'Section Plane' image,
    and adjust the depth of the section using the 'Distance'
    slider.
</p>
<p>
    If overlays are defined for an image, you may be able to
    click on highlighted anatomical features and an exciting
    dialog box will be displayed with the name of the
    feature.
</p>
<h2>How it works</h2>
<p>
    The Internet Imaging Protocol (IIP) allows sections of
    high-resolution image data stored on a server to be
    transmitted in the form of tiles, thereby allowing users to
    selectively view parts of a large image without having to
    download them in their entirety.  Tiles of multiple
    resolution levels are stored on the server in pyramidal 
    TIFF files, which further reduces bandwidth requirements 
    when only a low-resolution view is requested.  The <a href="http://iipimage.sourceforge.net/">IIP server</a>
    runs as a FastCGI program on a web server in the MRC Human
    Genetics Unit.
</p>
<p>
    The IIP client here has been written
    in-house at the MRC HGU to communicate with the IIP server
    and retrieve image tiles and arrange them in a web browser
    window in a similar manner to Google Maps.
</p>
<p>
    Currently supported image formats are:
    <ul>
        <li>
            pyramidal TIFF, which may be created using the<a href="http://www.vips.ecs.soton.ac.uk/">VIPS image
                processing system</a>. Shell scripts have been written
            to automate this task.
        </li>
        <li>
            stacks of pyramidal TIFF images, which are indexed
            via a JSON metadata file containing information on the
            properties of the stack.
        </li>
        <li>
            HGU 'Woolz' objects.
        </li>
    </ul>
</p>
<h2>Installation</h2>
<p>
    If JSON metadata files are to be kept together with their
    corresponding images on the filesystem, two path variables
    must be specified.  The FCGI server uses paths relative to
    the server's filesystem root since it executes on the
    server, while Javascript code uses a path relative to the
    Apache web root since it executes on the client.  Since it
    would be unwise to allow Apache to see the entire
    filesystem, an appropriate solution is to create an alias
    leading to the IIP image material.
</p>
<p>
    As an example, on my test machine the IIP data is 
    located within 
    <code>
        /export/data0/iip/projects/
    </code>, so
    I placed the following directive in an appropriate Apache
    configuration file:<pre>
Alias /iip-projects/ "/export/data0/iip/projects/"
      </pre>
</p>
<p>
    The web path is set as 
    <code>
        webpath
    </code>
    in
    <code>
        wlziipviewer.php
    </code>, and in the above example it 
    would take the value 
    <code>
        "/iip-projects/"
    </code>.  This
    is only required for image stacks, and is unnecessary for
    single images and Woolz objects.
</p>
<p>
    The filesystem path is set as 
    <code>
        fspath
    </code>
    in
    <code>
        wlziipviewer.php
    </code>, and in the above example it 
    would take the value 
    <code>
        "/export/data0/iip/projects/"
    </code>.  This
    is required for all displayable resources.
</p>
<p>
    The common path is set as 
    <code>
        stackpath
    </code>
    in
    the metadata file for the stack, and is only required for
    image stacks.
</p>
<h2>Metadata</h2>
Configuration variables define:
<ul>
    <li>
        properties of the server, such as the Apache alias 
        corresponding to the 
        <code>
            webpath
        </code>
        variable or the
        list of required GUI components
    </li>
    <li>
        properties of TIFF images or Woolz objects that are
        retrievable as IIP objects, such as the size of each
        image
    </li>
    <li>
        properties of collections of images that must be
        specified in JSON files that are loaded on request, such
        as the path to the image resource
    </li>
    <li>
        properties of the user (in some sense) that are
        specified in the URL, captured by PHP and cleverly
        inserted into the Javascript code that is then sent back
        to the client.
    </li>
</ul>
Described here is the format for JSON metadata files.
<dl>
    <dt>
        <code>
            metadata_version
        </code>
    </dt>
    <dd>
        Use "1.02" for now.
    </dd>
    <dt>
        <code>
            stackpath
        </code>
    </dt>
    <dd>
        Described above.
    </dd>
    <dt>
        <code>
            zsimgsrc
        </code>
    </dt>
    <dd>
        Location of a selector image from stackpath.
    </dd>
    <dt>
        <code>
            zselwidth
        </code>
    </dt>
    <dd>
        Width of above image.
    </dd>
    <dt>
        <code>
            zselheight
        </code>
    </dt>
    <dd>
        Height of above image.
    </dd>
    <dt>
        <code>
            zsliceorientation
        </code>
    </dt>
    <dd>
        'horizonal' or 'vertical' depending on the desired
        orientation of the selector bar.
    </dd>
    <dt>
        <code>
            zseldragborderlefttop
        </code>
    </dt>
    <dd>
        Minimum extent of the selector bar.
    </dd>
    <dt>
        <code>
            zseldragborderrightbottom
        </code>
    </dt>
    <dd>
        Maximum extent of the selector bar.
    </dd>
    <dt>
        <code>
            imagepath
        </code>
    </dt>
    <dd>
        Location of images.
    </dd>
    <dt>
        <code>
            overlaypath
        </code>
    </dt>
    <dd>
        Location of overlay data (optional).
    </dd>
</dl>
<p>
    A complete metadata file might hence appear thus:
</p>
